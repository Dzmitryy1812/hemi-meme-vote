<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (остальные мета-теги и стили остаются без изменений) ... -->
</head>
<body class="bg-orange-50 text-orange-900 font-sans min-h-screen">
  <!-- ... (остальная разметка без изменений) ... -->

  <script>
    // Конфигурация Hemi Testnet (из официальной документации)
    const HEMI_TESTNET_CONFIG = {
      chainId: '0x4159', // 16729 в hex
      chainName: 'Hemi EVM Testnet',
      nativeCurrency: {
        name: 'HEMI',
        symbol: 'HEMI',
        decimals: 18
      },
      rpcUrls: ['https://testnet.rpc.hemi.network'],
      blockExplorerUrls: ['https://testnet.explorer.hemi.network/']
    };

    // Тестовые адреса контрактов (пример, замените своими)
    const TESTNET_CONTRACTS = {
      memeFactory: '0xAbC123...', // Ваш адрес контракта
      voting: '0xDeF456...'
    };

    // ABI контрактов (адаптируйте под ваши контракты)
    const MEME_FACTORY_ABI = [
      "function createMeme(string memory title, string memory url) public",
      "function getAllMemes() public view returns (tuple(uint256 id, string title, string url, uint256 votes, address author)[] memory)"
    ];

    let provider;
    let signer;
    let memeContract;

    async function initContracts() {
      memeContract = new ethers.Contract(
        TESTNET_CONTRACTS.memeFactory,
        MEME_FACTORY_ABI,
        signer
      );
    }

    async function connectWallet() {
      if (window.ethereum) {
        try {
          // Добавляем Hemi Testnet в кошелек
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [HEMI_TESTNET_CONFIG]
          });

          // Переключаемся на Hemi Testnet
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: HEMI_TESTNET_CONFIG.chainId }]
          });

          provider = new ethers.providers.Web3Provider(window.ethereum, "any");
          await provider.send("eth_requestAccounts", []);
          signer = provider.getSigner();
          
          await initContracts();

          const address = await signer.getAddress();
          document.getElementById("connectButton").innerHTML = `
            <i class="fas fa-check-circle mr-1"></i>
            <span class="hidden sm:inline">${address.slice(0, 6)}...${address.slice(-4)}</span>
          `;
          isConnected = true;
          await loadMemes();

        } catch (error) {
          console.error("Connection error:", error);
          alert(`Hemi Testnet Error: ${error.message}`);
        }
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function loadMemes() {
      try {
        const rawMemes = await memeContract.getAllMemes();
        memes = rawMemes.map(meme => ({
          id: meme.id.toNumber(),
          title: meme.title,
          imageUrl: meme.url,
          votes: meme.votes.toNumber(),
          author: meme.author
        }));
      } catch (error) {
        console.error("Loading error:", error);
        memes = fallbackMemes;
      }
      updateStats();
      renderMemes();
    }

    async function voteMeme(memeId) {
      try {
        const tx = await memeContract.vote(memeId);
        await tx.wait();
        
        const meme = memes.find(m => m.id === memeId);
        if (meme) {
          meme.votes += 1;
          updateStats();
          renderMemes();
        }
      } catch (error) {
        console.error("Voting error:", error);
        alert("Vote failed: " + error.message);
      }
    }

    document.getElementById("memeForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const title = document.getElementById("memeTitle").value;
      const url = document.getElementById("memeUrl").value;
      
      try {
        const tx = await memeContract.createMeme(title, url);
        await tx.wait();
        await loadMemes();
        document.getElementById("uploadModal").classList.add("hidden");
      } catch (error) {
        console.error("Upload error:", error);
        alert("Upload failed: " + error.message);
      }
    });

    // ... (остальные функции без изменений) ...
  </script>
</body>
</html>
